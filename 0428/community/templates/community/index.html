{% extends 'base.html' %} {% block content %}
<h1>Community</h1>
<hr />
{% for review in reviews %}
<p>
  ì‘ì„±ì :
  <a href="{% url 'accounts:profile' review.user.username %}"
    >{{ review.user }}</a
  >
</p>
<p>ê¸€ ë²ˆí˜¸: {{ review.pk }}</p>
<p>ê¸€ ì œëª©: {{ review.title }}</p>
<p>ê¸€ ë‚´ìš©: {{ review.content }}</p>
<form class="like-form" data-review-id="{{review.pk}}">
  {% csrf_token %} {% if user in review.like_users.all %}
  <button
    id="like-{{ review.pk }}"
    style="border: 0.5px; background-color: transparent"
  >
    UNLIKEğŸ’”
  </button>
  {% else %}
  <button
    id="like-{{ review.pk }}"
    style="border: 0.5px; background-color: transparent"
  >
    LIKEâ¤ï¸
  </button>
  {% endif %}
</form>
<p>
  <span id="like-count-{{review.pk}}"> {{review.like_users.all|length }} </span>
  ëª…ì´ ì´ ê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.
</p>
<a href="{% url 'community:detail' review.pk %}">[detail]</a>
<hr />
{% endfor %} {% endblock content %} {% block script %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  const reviews = document.querySelectorAll(".like-form");
  const csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value;
  reviews.forEach((review) => {
    review.addEventListener("submit", function (event) {
      event.preventDefault();
      const reviewId = event.target.dataset.reviewId;

      axios({
        method: "post",
        url: `/community/${reviewId}/like/`,
        headers: { "X-CSRFToken": csrftoken },
      })
        .then((response) => {
          const isLiked = response.data.is_liked;
          const spanTag = document.querySelector(`#like-count-${reviewId}`);
          const likeBtn = document.querySelector(`#like-${reviewId}`);
          if (isLiked === true) {
            likeBtn.innerText = "UNLIKEğŸ’”";
            spanTag.innerText = response.data.count;
          } else {
            likeBtn.innerText = "LIKEâ¤ï¸";
            spanTag.innerText = response.data.count;
          }
        })
        .catch((error) => {
          console.log(error.response);
        });
    });
  });
</script>
{% endblock script %}
